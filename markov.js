const names = {
    "alethi": {
        "male":[
            "Abry",
            "Acis",
            "Adolin",
            "Agil",
            "Alabet",
            "Aladar",
            "Alds",
            "Alili",
            "Arafik",
            "Aratin",
            "Ashelem",
            "Avarak",
            "Avaran",
            "Bashin",
            "Beard",
            "Beld",
            "Bethab",
            "Bordin",
            "Caull",
            "Cenn",
            "Colot",
            "Dabbid", //How could I miss Dabbid??
            "Dalar",
            "Dalinar",
            "Dallet",
            "Deedanor",
            "Dod",
            "Dok",
            "Dru",
            "Dunny",
            "Elhokar",
            "Elit",
            "Elthebar",
            "Falilar",
            "Febin",
            "Fin",
            "Galan",
            "Gallam",
            "Gavilar",
            "Graves",
            "Grund",
            "Gulastis",
            "Habrin",
            "Halad",
            "Halam",
            "Hallaw",
            "Hamadin",
            "Harl",
            "Harth",
            "Hatham",
            "Hathan",
            "Hav",
            "Havar",
            "Havarah",
            "Havrom",
            "Hid",
            "Idrin",
            "Ilamar",
            "Isasik",
            "Ivanar",
            "Jakamav",
            "Jam",
            "Jeber",
            "Jest",
            "Jor",
            "Jorna",
            "Jost",
            "Kadash",
            "Kaladin",
            "Kalanor",
            "Kalishnor",
            "Kelerand",
            "Khav",
            "Khem",
            "Koen",
            "Lamaril",
            "Lanacin",
            "Lirin",
            "Loats",
            "Loradar",
            "Lustow",
            "Mabrow",
            "Malan",
            "Malop",
            "Marf",
            "Marks",
            "Matain",
            "Matal",
            "Meleran",
            "Meridas",
            "Milp",
            "Moash",
            "Mord",
            "Nacomb",
            "Naget",
            "Natam",
            "Natir",
            "Niter",
            "Noril",
            "Noromin",
            "Oroden",
            "Paladar",
            "Perethom",
            "Ral",
            "Ralinor",
            "Rembrinor",
            "Renarin",
            "Resi",
            "Rial",
            "Rillir",
            "Rind",
            "Rine",
            "Roion",
            "Sadeas",
            "Sadees",
            "Salinor",
            "Serugiadis",
            "Shaday",
            "Sheler",
            "Shim",
            "Sidin",
            "Sidin",
            "Skar",
            "Taka",
            "Talanan",
            "Talanor",
            "Taleb",
            "Tanalan",
            "Tarn",
            "Taselin",
            "Tearim",
            "Teft",
            "Teleb",
            "Tenathar",
            "Teofil",
            "Thakka",
            "Thanadal",
            "Tibon",
            "Tien",
            "Tinalar",
            "Tomor",
            "Ton",
            "Toravi",
            "Torol",
            "Tukks",
            "Turinad",
            "Urimil",
            "Vaceslv",
            "Valama",
            "Vardinar",
            "Vartian",
            "Vedekar",
            "Velalant",
            "Ven",
            "Vevidar",
            "Wistiow",
            "Yenev",
            "Yezriar"
        ],
        "female": [
            "Aesudan",
            "Alami",
            "Alaward",
            "Chanada",
            "Danlan",
            "Eshava",
            "Hamaradin",
            "Hashal",
            "Hesina",
            "Ialai",
            "Idani",
            "Inadara",
            "Inkima",
            "Insah",
            "Ishal",
            "Ishnah",
            "Istow",
            "Ithi",
            "Ivis",
            "Janala",
            "Jasalai",
            "Jasnah",
            "Jayla",
            "Jenet",
            "Jevena",
            "Kara",
            "Kusiri",
            "Lalai",
            "Laral",
            "Laran",
            "Leven",
            "Litima",
            "Lyn",
            "Mara",
            "Maratham",
            "Mela",
            "Miasal",
            "Mishinah",
            "Muri",
            "Nall",
            "Nananav",
            "Navani",
            "Relina",
            "Ristina",
            "Rushu",
            "Sani",
            "Seland",
            "Sivi",
            "Tarah",
            "Terith",
            "Teshav",
            "Ulina",
            "Velat"
        ],
        "surname": [
            "Alami",
            "Amaram",
            "Bethab",
            "Elthal",
            "Eved",
            "Gaval",
            "Hatham",
            "Khal",
            "Kholin",
            "Marakal",
            "Morakotha",
            "Perel",
            "Roshone",
            "Ruthar",
            "Sadeas",
            "Sebarial",
            "Shulin",
            "Vamah"
        ]
    },
    "singers": {
        "male": [
            "Abaray",
            "Abronai",
            "Aharat",
            "Alavah",
            "Altoki",
            "Bru",
            "Davim",
            "Demid",
            "Devi",
            "Dor",
            "Dul",
            "Durnash",
            "El",
            "Faridai",
            "Gitgeth",
            "Harel",
            "Harvo",
            "Husal",
            "Jeshishin",
            "Jial",
            "Klade",
            "Kyril",
            "Lezian",
            "Malal",
            "Mizthla",
            "Mrun",
            "Nam",
            "Nistar",
            "Rine",
            "Rlain",
            "Ron",
            "Rothan",
            "Sah",
            "Sharefel",
            "Thude",
            "Ton",
            "Turash",
            "Tusa",
            "Urialin",
            "Uriam",
            "Varanis",
            "Vod",
            "Zandiel",
        ],
        "female": [
            "Abiajan",
            "Alavah",
            "Bila",
            "Brianlia",
            "Chivi",
            "Dianil",
            "Dolimid",
            "Dor",
            "Eshonai",
            "Essu",
            "Gangnah",
            "Harel",
            "Hariel",
            "Harvo",
            "Hesh",
            "Hnanan",
            "Husal",
            "Jaxlim",
            "Khen",
            "Leshwi",
            "Malal",
            "Mazish",
            "Melu",
            "Mikaim",
            "Nistar",
            "Pal",
            "Raboniel",
            "Ron",
            "Shumin",
            "Tusa",
            "Urialin",
            "Uriam",
            "Vai",
            "Varnali",
            "Vatwha",
            "Venli",
            "Zandiel",
            "Zuln",
        ]
    },
    "veden": {
        "male": [
            "Abrial",
            "Amark",
            "Balat",
            "Beal",
            "Boriar",
            "Ekel",
            "Evinor",
            "Geved",
            "Gevelmar",
            "Hanavanar",
            "Helaran",
            "Jal",
            "Jix",
            "Jushu",
            "Lin",
            "Luesh",
            "Mill",
            "Nalanar",
            "NanHar",
            "NanKhet",
            "Redin",
            "Ren",
            "Revilar",
            "Rin",
            "Sur",
            "Talak",
            "Tavinar",
            "Ten",
            "Ton",
            "Urian",
            "Urv",
            "Valam",
            "Wikim"
        ],
        "female": [
            "Eylita",
            "Hasheh",
            "Malata",
            "Malise",
            "Mem",
            "Natata",
            "Shallan",
            "Sudi"
        ],
        "surname": [
            "Davar",
            "Kamar",
            "Ved"
        ]
    },
    "thaylen": {
        "male": [
            "Alstben",
            "Artmyrn",
            "Barmest",
            "Beznk",
            "Brekv",
            "Estnatil",
            "Febrth",
            "Fimkn",
            "Fladm",
            "Flend",
            "Hrdalm",
            "Jochi",
            "Kdralk",
            "Klisn",
            "Kmakl",
            "Kstled",
            "Mraize",
            "Mrall",
            "Nlan",
            "Plamry",
            "Pluv",
            "Smta",
            "Tlik",
            "Tozbek",
            "Tshadr",
            "Turlm",
            "Tvlakv",
            "Vaceslv",
            "Vaceslv",
            "Vazrmeb",
            "Vazrmeb",
            "Vlxim",
            "Vstim",
            "Wvlan",
            "Wzmal",
            "Yalb",
            "Yokska"
        ],
        "female": [
            "Ashlv",
            "Chanrm",
            "Devmrh",
            "Drlwan",
            "Fen",
            "Hmalka",
            "Kmakra",
            "Rysn",
            "Ulvlk",
            "Vldgen",
            "Vrandl"
        ]
    },
    "glyph": [
        "abara",
        "adoda",
        "amaya",
        "bakhash",
        "beteb",
        "chach",
        "gesheh",
        "idi",
        "ishi",
        "javani",
        "jeseh",
        "kadulek",
        "kak",
        "kalak",
        "katef",
        "kecheh",
        "khakh",
        "khokh",
        "laial",
        "lerel",
        "linil",
        "markhazh",
        "mehlak",
        "merem",
        "mevizh",
        "morom",
        "nahn",
        "nan",
        "palah",
        "parap",
        "sas",
        "sebes",
        "shash",
        "shash",
        "shenesh",
        "tafar",
        "tanat",
        "tebel",
        "thath",
        "tsameth",
        "vev",
        "zatalef",
        "zeras"
    ]
};

function generate_corpus(names) {
    let corpus = [];

    names.forEach((el, ar) => {
        el += '\n';
        corpus.push.apply(corpus, el.split(''));
    });

    return corpus;
}

function generate_chain(corpus) {
    let chain = {};
    let n_names = corpus.length;

    corpus.forEach((key1, i) => {
        let key2 = '';
        let letter = '';
        if (n_names > i + 2) {
            key2 = corpus[i + 1];
            letter = corpus[i + 2];
        }

        let key = key1 + key2;
        if (!chain[key]) {
            chain[key] = [letter];
        } else {
            chain[key].push(letter)
        }
    });

    return chain;
}

function markov(corpus, chain) {
    let nkey = '  ';
    while(
        nkey.charAt(0) === ' ' ||
        nkey.charAt(0) === nkey.charAt(0).toLowerCase() ||
        nkey.charAt(0) === '\n' ||
        !chain[nkey]
    ) {
        let key1 = corpus[Math.floor(Math.random() * corpus.length)];
        let key2 = corpus[Math.floor(Math.random() * corpus.length)];
        nkey = key1 + key2;
    }

    let l = '';
    let name = nkey;
    while (l !== '\n') {
        l = chain[nkey][Math.floor(Math.random() * chain[nkey].length)];
        name += l;
        nkey = nkey.charAt(1) + l;
    }

    // Take off carriage return
    return name.slice(0, -1);

}
var serialize = function (form) {
	// Setup our serialized data
	var serialized = {};

	// Loop through each field in the form
	for (var i = 0; i < form.elements.length; i++) {
        var field = form.elements[i];
		// Don't serialize fields without a name, submits, buttons, file and reset inputs, and disabled fields
		if (!field.name || field.disabled || field.type === 'file' || field.type === 'reset' || field.type === 'submit' || field.type === 'button') continue;

		// If a multi-select, get all selections
		if (field.type === 'select-multiple') {
			for (var n = 0; n < field.options.length; n++) {
				if (!field.options[n].selected) continue;
				serialized[encodeURIComponent(field.name)] = encodeURIComponent(field.options[n].value);
			}
		}

		// Convert field data to a query string
		else if ((field.type !== 'checkbox' && field.type !== 'radio') || field.checked) {
			serialized[encodeURIComponent(field.name)] = encodeURIComponent(field.value);
		}
	}

	return serialized;
};

function parse(form) {
    let options = serialize(form);
    let name_list = [];
    if (options.gender === "both") {
        name_list = name_list.concat(names[options.ethnic]['male'], names[options.ethnic]['female']);
    } else {
        name_list = name_list.concat(names[options.ethnic][options.gender]);
    }

    // Since Alethkar & Jah Keved both follow Vorinism, we can assume that they follow a glyph-based naming convention.
    if ((options.ethnic === "alethi" || options.ethnic === "veden") && options.glyph === "true") {
        name_list = name_list.concat(names['glyph']);
    }

    return name_list;
}

function generate() {
    // Parse form
    let form = document.querySelector('form');
    let name_list = parse(form);

    // Markov stuff
    let corpus = generate_corpus(name_list);
    let chain = generate_chain(corpus);
    let name = markov(corpus, chain);

    document.getElementById("result").innerHTML = name;

    // Bonus!
    if (name_list.includes(name)) {
        console.log("Hey this is in the book!");
    }
}

function disableGlyph(event) {
    if(event.value === "singers" || event.value === "thaylen") {
        document.getElementById('glyph').disabled = true;
    } else {
        document.getElementById('glyph').disabled = false;
    }
}
